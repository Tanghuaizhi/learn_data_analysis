---
title: "lesson4_practice"
output: html_notebook
---

## Practice 1: 价格与x

Note:
In this problem set, you'll continue to explore the diamonds data set.
Your first task is to create a scatterplot of price vs x. using the ggplot syntax.

```{r}
getwd()
setwd("D:/learn_data_analysis/R basic/lesson4")

library(ggplot2)

data(diamonds)

names(diamonds)
head(diamonds)

ggplot(data = diamonds, aes(x = x, y = price)) +
  geom_point(alpha = 1/10)
```

## Practice 2: 发现 价格与X

### What are your observations about the scatterplot of price vs. x?
1、总体上，价格和长度存在明显的相关性，随着长度变化，价格指数型上升。
2、存在极其少量异常数据，长度（x）为零。
3、大部分长度数据集中在7以下，同时此部分的价格也较为集中，大部分在7500以内。
4、长度为6左右以下的的价格十分稳定，均不超过7500。
5、长度在7.5左右、8左右的钻石数量较为明显。

```{r}
ggplot(data = diamonds, aes(x = x, y = price)) +
  geom_point(alpha = 1/5) +
  coord_trans(y = "log2")

```

## Practice 3: 相关性

### what is the correlation between price and x?
0.88
### what is the correlation between price and y?
0.87
### what is the correlation between price and z?
0.86

```{r}
cor.test(diamonds$x, diamonds$price)
cor.test(diamonds$y, diamonds$price)
cor.test(diamonds$z, diamonds$price)
```

## Practice 4: 价格与深度

Create a simple scatter plot of price vs depth.

```{r}
ggplot(data = diamonds, aes(x = depth, y = price)) +
  geom_point(alpha = 1/5)

```

## Practice 5: 调整-价格与深度

Change the code to make the transparency of the points to be 1/100 of what they are now and mark the x-axis every 2 units. See the instructor notes for two hints.

```{r mark the x-axis every 2 units}
ggplot(data = diamonds, aes(x = depth, y = price)) +
  geom_point(alpha = 1/100) +
  scale_x_continuous(breaks = seq(0, 80, 2))

```


## Practice 6: 典型深度范围

### Based on the scatterplot of depth vs. price, most diamonds are between what values of depth?
58-64


## Practice 7: 相关性-价格与深度

### what the correlation of depth vs. price?
-0.01
### Based on the correlation coefficient would you use depth to predict the price of a diamond?
No
### Why?
相关性太低了，几乎没有关系，无法用来预测。

```{r}
cor.test(diamonds$depth, diamonds$price)
```


## Practice 8: 价格与克拉

Create a scatterplot of price vs carat and omit the top 1% of price and carat values.

```{r omit top 1%}
p1 <- ggplot(data = diamonds, aes(x = carat, y = price)) +
  geom_point(alpha = 1/100)

p2 <- ggplot(data = diamonds, aes(x = carat, y = price)) +
  geom_point(alpha = 1/100) +
  xlim(0, quantile(diamonds$carat, 0.99)) +
  ylim(0, quantile(diamonds$price, 0.99))

library(gridExtra)
grid.arrange(p1, p2, ncol =1)

```

## Practice 9: 价格与体积

Create a scatterplot of price vs. volume (x * y * z).
This is a very rough approximation for a diamond's volume.

Create a new variable for volume in the diamonds data frame.
This will be useful in a later exercise.

Don't make any adjustments to the plot just yet.

```{r}
diamonds$volume = with(diamonds, x * y * z)

ggplot(data = diamonds, aes(x = volume, y = price)) +
  geom_point(alpha = 1/100) +
  xlim(0, quantile(diamonds$volume, 0.99)) +
  ylim(0, quantile(diamonds$price, 0.99)) 
```

## Practice 10: 发现-价格与体积

### What are your observations from the price vs. volume sactterplot?
1、价格和体积相关性高，有较为明显的线性关系。
2、体积大部分在200以内。
3、价格大多在7500以内。
4、体积在160以下时，体积与价格相关性十分明显。

## Practice 11: 子集相关性

### what's the correlation of price and volume? Exclude diamonds that have a volume of 0 or that are greater than or equal to 800

0.92

```{r}
a <- subset(diamonds, volume != 0 & volume < 800)

cor.test(a$volume, a$price)
```

## Practice 12: 调整-价格与体积

Subset the data to exclude diamonds with a volume greater than or equal to 800. 
Also, exclude diamonds with a volume of 0. 
Adjust the transparency of the points and add a linear model to the plot. (See the Instructor Notes or look up the documentation of geom_smooth() for more details about smoothers.)

We encourage you to think about this next question and to post your thoughts in the discussion section.

### Do you think this would be a useful model to estimate the price of diamonds? Why or why not?
看起来拟合程度不错。需要有方法进行评估。


```{r}
ggplot(data = a, aes(x = volume, y = price)) +
  geom_point(alpha = 1/100) +
  xlim(0, quantile(a$volume, 0.99)) +
  ylim(0, quantile(a$price, 0.99)) +
  geom_smooth(method = "lm", color = 'red')
```


## Practice 13: 平均价格-净度
Use the function dplyr package to create a new data frame containing info on diamonds by clarity.

Name the data frame diamondsByClarity 

The data frame should contain the following variables in this order.
       (1) mean_price
       (2) median_price
       (3) min_price
       (4) max_price
       (5) n
       
where n is the number of diamonds in each level of clarity.

注意：如果你在进行此练习之前使用了 plyr 包中的 count() 函数，则需要运行以下命令卸载 plyr 包。 
detach("package:plyr", unload=TRUE) 
dplyr包。

```{r}
library(dplyr)

diamondsByClarity <- diamonds %>%
  group_by(clarity) %>%
  summarise(mean_price = mean(price),
            median_price = median(price),
            min_price = min(price),
            max_price = max(price),
            n = n())

```

## Practice 14: 平均价格柱状图
We’ve created summary data frames with the mean price by clarity and color. 
You can run the code in R to verify what data is in the variables diamonds_mp_by_clarity and diamonds_mp_by_color.

Your task is to write additional code to create two bar plots on one output image using the grid.arrange() function from the package gridExtra.

This assignment is not graded and will be marked as correct when you submit.

See the Instructor Notes for more info on bar charts and for a hint on this task.

```{r}
data(diamonds)
library(dplyr)

diamonds_by_clarity <- group_by(diamonds, clarity)
diamonds_mp_by_clarity <- summarise(diamonds_by_clarity, mean_price = mean(price))

diamonds_by_color <- group_by(diamonds, color)
diamonds_mp_by_color <- summarise(diamonds_by_color, mean_price = mean(price))



bar1 <- ggplot(data = diamonds_mp_by_clarity, aes(x = clarity, y = mean_price)) +
  geom_col()
bar2 <- ggplot(data = diamonds_mp_by_color, aes(x = color, y = mean_price)) +
  geom_col()

library(gridExtra)
grid.arrange(bar1, bar2, ncol =1)

```


## Practice 15: 平均价格的趋势图

### what do you notice in each of the bar charts for mean price by clarity and mean price by color?
按纯度的价格是先上升后下降最后再上升，有一定波动;
按颜色的价格是上升趋势，颜色越好价格越高.

## Practice 16: 重访 Gapminder

The Gapminder website contains over 500 data sets with information about the world's population. Your task is to continue the investigation you did at the end of Problem Set 3 or you can start fresh and choose a different data set from Gapminder.

If you’re feeling adventurous or want to try some data munging see if you can find a data set or scrape one from the web.

In your investigation, examine pairs of variable and create 2-5 plots that make use of the techniques from Lesson 4.

You can find a link to the Gapminder website in the Instructor Notes.

Once you've completed your investigation, create a post in the discussions that includes:
       1. the variable(s) you investigated, your observations, and any summary statistics
       2. snippets of code that created the plots
       3. links to the images of your plots



#### 获取全球农用地数据
从Gapminder上下载全球农用地数据，并读入。

```{r agriculture land data}
getwd()
dir()

library(ggplot2)
pf <- read.csv('agriculture_land.csv', header = TRUE, sep = ',')
```

#### 评估数据并清理
网站上数据的质量是比较高的。
拟采用目测评估的方式进行简单清理。
此部分拟用python来完成。
